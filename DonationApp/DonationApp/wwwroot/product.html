<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Katar Kherak</title>
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glider-js@1/glider.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/assets/css/index.css">
</head>


<body>
    <style>
        nav {
            position: relative !important;
        }
    </style>
    <nav class="navbar navbar-expand-lg bg-light fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">
                <img src="/assets/imgs/logo.png" alt="" width="70">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav w-100 d-flex justify-content-end">
                    <li class="nav-item">
                        <a class="nav-link about" aria-current="page" href="/about.html">About us</a>
                    </li>
                    <li class="nav-item d-lg-flex align-items-center">
                        <a class="nav-link find-food" aria-current="page" href="/products.html">
                            <i class="bi bi-geo-alt"></i> Find Food
                        </a>
                        <a class="nav-link donate" aria-current="page" href="/donate.html">
                            <i class="bi bi-heart"></i> Donate
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>




    <section id="product" class="mt-4">
        <div class="container">
            <div class="row">

                <!-- Product imgs -->
                <div id="ImagesDiv" class="col-12 col-md-5">

                    <!--<div class="main_img">
                <img class="card-img" src="/assets/imgs/products/product1.jpg" alt="" height="400" style="object-fit: cover;">
            </div>

            <div class="row mt-2 mini_imgs">
                <div class="col">
                    <img src="/assets/imgs/products/product2.jpg" alt="" height="90">
                </div>
                <div class="col">
                    <img src="/assets/imgs/products/product3.jpg" alt="" height="90">
                </div>
                <div class="col">
                    <img src="/assets/imgs/products/product1.jpg" alt="" height="90">
                </div>
            </div>-->


                </div>

                <!-- Product details -->
                <div class="col-12 col-md-5 mx-auto">

                    <div id="productDetailsDiv" class="product_details">
                        <button id="Reserve" type="button" class="btn btn-sm btn-primary">Reserve</button>
                        <!--<h3 class="text-uppercase mb-3">Product title</h3>

    <div>
        <h6>Description:</h6>
        <span>Lorem ipsum, dolor sit amet consectetur adipisicing elit. Ex rem culpa quae natus eveniet? Molestiae voluptas exercitationem consectetur quam maxime totam.</span>
    </div>

    <div>
        <h6 class="mt-3">Ingredients:</h6>
        <ul>
            <li><span> (15 ounce) container ricotta cheese</span></li>
            <li><span> (8 ounce) package shredded mozzarella cheese, divided</span></li>
            <li><span> (3 ounce) package Parmesan cheese</span></li>
            <li><span> egg</span></li>
            <li><span>2 teaspoons Italian seasoning</span></li>
            <li><span> pound sausage</span></li>
            <li><span>½ (26 ounce) jar marinara sauce</span></li>
            <li><span>6 flatbreads</span></li>
        </ul>
    </div>

    <div>
        <h6 class="mt-3">Extra notes:</h6>
        <span>gluten free</span>
    </div>-->

                    </div>
                </div>

                <div class="col-12 col-md-12">
                    <label for="dish_address" class="form-label">Meeting Point</label>
                    <div id="map" style="display:block; height:500px"></div>
                </div>
            </div>
        </div>
    </section>

    <footer class="pt-4">
        <div class="container">

            <div class="row">
                <div class="col">
                    <a class="navbar-brand" href="#">
                        <img src="/assets/imgs/logo.png" alt="" width="100">
                    </a>
                </div>

                <div class="col">
                    <h6>John Doe 12, 15547 Cairo</h6>
                    <h6>0123254847</h6>
                </div>

                <div class="col">
                    <a href=""><i class="bi bi-facebook"></i></a>
                    <a href=""><i class="bi bi-instagram"></i></a>
                    <a href=""><i class="bi bi-twitter"></i></a>
                    <a href=""><i class="bi bi-youtube"></i></a>
                </div>
            </div>

            <div class="text-center bg-light mt-2">
                <span class="m-0 mt-2 copy-rights">Copyright ©2022 Katar Kherak</span>
                <span class="m-0 copy-rights">All Rights Reserved</span>
            </div>
        </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/glider-js@1/glider.min.js"></script>
    <script src="/assets/js/bootstarp.bundel.js"></script>
    <script src="/lib/jquery/dist/jquery.min.js"></script>
    <script src="/assets/js/main.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDpfS1oRGreGSBU5HHjMmQ3o5NLw7VdJ6I&callback=initMap" async defer></script>
    <script>
        $(document).ready(function () {


            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('id');
            $.ajax({
                url: '/api/DonationsAPI/' + productId,
                type: 'Get',
                success: function (res) {
                    if (res.status == 2) {
                        $("#Reserve").attr('disabled', 'disabled');
                    }
                    var innerImages = "";
                    $.each(res.donationAttachmentViewModels, function (data, value) {
                        innerImages += "<div class='col' > " +
                            "<img src='data:image;base64," + value.src + "' alt='' height='90'>" +
                            "</div>";
                    });

                    $("#ImagesDiv").append($("<div class='main_img'>" +
                        "<img class='card-img' src ='data:image;base64," + res.donationAttachmentViewModels[0].src + "' alt='' height='400' style='object-fit: cover;'>" +
                        "</div>" +
                        "<div class='row mt-2 mini_imgs'>" +
                        innerImages +
                        "</div>"));

                    var date = new Date(res.preparedDate);
                    var formatedDate = ((date.getDate() > 9) ? date.getDate() : ('0' + date.getDate())) + '/' + ((date.getMonth() > 8) ? (date.getMonth() + 1) : ('0' + (date.getMonth() + 1))) + '/' + date.getFullYear();
                    $("#productDetailsDiv").append($("<h3 class='text-uppercase mb-3'>" + res.title + "</h3>" +
                        "<div>" +
                        "<h6>Description:</h6>" +
                        "<span>" + res.description + "</span >" +
                        "</div>" +
                        "<div>" +
                        "<h6 class='mt-3'>Details Info</h6>" +
                        "<ul>" +
                        "<li><span> Enough for (Persons nr): " + res.enoughFor + "</span></li>" +
                        "<li><span> Dish prepared date: " + formatedDate + "</span></li>" +
                        "<li><span> City: " + res.cityName + "</span></li>" +
                        "<li><span> District: " + res.districtName + "</span></li>" +
                        "<li><span> Meeting Address: " + res.address + "</span></li>" +
                        "</ul>" +
                        "</div>" +
                        "<div>" +
                        "<h6 class='mt-3'>Extra notes:</h6>" +
                        "<span>" + res.extraNotes + "</span>" +
                        "</div>"));


                    const mainImg = document.querySelector('#product .main_img img');
                    const miniImgs = [...document.querySelectorAll('#product .mini_imgs img')];

                    miniImgs.forEach(img => {
                        img.addEventListener('mouseover', () => {
                            mainImg.src = img.src;
                        });
                    });

                    var map = new google.maps.Map(document.getElementById('map'), {
                        zoom: 17,
                        center: new google.maps.LatLng(res.latitude, res.longitude),
                        mapTypeId: google.maps.MapTypeId.ROADMAP,
                        provideRouteAlternatives: true,
                        travelMode: 'DRIVING'
                    });
                    var markers = new Array();
                    var marker, i;
                    var infowindow = new google.maps.InfoWindow();
                    //for (i = 0; i < data.length; i++) {
                    var svgMarker = {
                        path: "M10.453 14.016l6.563-6.609-1.406-1.406-5.156 5.203-2.063-2.109-1.406 1.406zM12 2.016q2.906 0 4.945 2.039t2.039 4.945q0 1.453-0.727 3.328t-1.758 3.516-2.039 3.070-1.711 2.273l-0.75 0.797q-0.281-0.328-0.75-0.867t-1.688-2.156-2.133-3.141-1.664-3.445-0.75-3.375q0-2.906 2.039-4.945t4.945-2.039z",
                        fillColor: "green",
                        fillOpacity: 0.6,
                        strokeWeight: 0,
                        rotation: 0,
                        scale: 2,
                        anchor: new google.maps.Point(15, 30),
                    };
                    if (res.status == 2) {
                        svgMarker = {
                            path: "M10.453 14.016l6.563-6.609-1.406-1.406-5.156 5.203-2.063-2.109-1.406 1.406zM12 2.016q2.906 0 4.945 2.039t2.039 4.945q0 1.453-0.727 3.328t-1.758 3.516-2.039 3.070-1.711 2.273l-0.75 0.797q-0.281-0.328-0.75-0.867t-1.688-2.156-2.133-3.141-1.664-3.445-0.75-3.375q0-2.906 2.039-4.945t4.945-2.039z",
                            fillColor: "red",
                            fillOpacity: 0.6,
                            strokeWeight: 0,
                            rotation: 0,
                            scale: 2,
                            anchor: new google.maps.Point(15, 30),
                        };
                    }
                    var marker = new google.maps.Marker(
                        {
                            position: new google.maps.LatLng(res.latitude, res.longitude),
                            map: map,
                            animation: google.maps.Animation.DROP,
                            icon: svgMarker
                        }
                    );

                    markers.push(marker);

                    google.maps.event.addListener(marker, 'click', (function (marker, i) {
                        return function () {
                            infowindow.setContent(res.title + " - " + res.districtName);
                            infowindow.open(map, marker);
                        }
                    })(marker, i));

                    AutoCenter();
                },
                error: function (res) {
                    alert("error");
                }
            });

            $("#Reserve").click(function () {
                $.ajax({
                    url: '/api/DonationsAPI/Reserve?id=' + productId,
                    type: 'Get',
                    success: function (res) {
                        $("#Reserve").attr('disabled', 'disabled');
                        alert(res);
                    }
                });
            });
        });

        //function initMap() {
        //    var map = new google.maps.Map(document.getElementById('map'), {
        //        zoom: 3,
        //        center: new google.maps.LatLng(30.016082069576182, 31.420657941527438),
        //        mapTypeId: google.maps.MapTypeId.ROADMAP,
        //        provideRouteAlternatives: true,
        //        travelMode: 'DRIVING'
        //    });
        //    var markers = new Array();
        //    var marker, i;
        //    var infowindow = new google.maps.InfoWindow();
        //    //for (i = 0; i < data.length; i++) {
        //        var svgMarker = {
        //            path: "M10.453 14.016l6.563-6.609-1.406-1.406-5.156 5.203-2.063-2.109-1.406 1.406zM12 2.016q2.906 0 4.945 2.039t2.039 4.945q0 1.453-0.727 3.328t-1.758 3.516-2.039 3.070-1.711 2.273l-0.75 0.797q-0.281-0.328-0.75-0.867t-1.688-2.156-2.133-3.141-1.664-3.445-0.75-3.375q0-2.906 2.039-4.945t4.945-2.039z",
        //            fillColor: "green",
        //            fillOpacity: 0.6,
        //            strokeWeight: 0,
        //            rotation: 0,
        //            scale: 2,
        //            anchor: new google.maps.Point(15, 30),
        //        };
        //        if (data[i].status == 2) {
        //            svgMarker = {
        //                path: "M10.453 14.016l6.563-6.609-1.406-1.406-5.156 5.203-2.063-2.109-1.406 1.406zM12 2.016q2.906 0 4.945 2.039t2.039 4.945q0 1.453-0.727 3.328t-1.758 3.516-2.039 3.070-1.711 2.273l-0.75 0.797q-0.281-0.328-0.75-0.867t-1.688-2.156-2.133-3.141-1.664-3.445-0.75-3.375q0-2.906 2.039-4.945t4.945-2.039z",
        //                fillColor: "red",
        //                fillOpacity: 0.6,
        //                strokeWeight: 0,
        //                rotation: 0,
        //                scale: 2,
        //                anchor: new google.maps.Point(15, 30),
        //            };
        //        }
        //        var marker = new google.maps.Marker(
        //            {
        //                position: new google.maps.LatLng(data[i].latitude, data[i].longitude),
        //                map: map,
        //                animation: google.maps.Animation.DROP,
        //                icon: svgMarker
        //            }
        //        );

        //        markers.push(marker);

        //        google.maps.event.addListener(marker, 'click', (function (marker, i) {
        //            return function () {
        //                infowindow.setContent(data[i].title + " - " + data[i].districtName);
        //                infowindow.open(map, marker);
        //            }
        //        })(marker, i));

        //        AutoCenter();
        //    //}
        //}

    </script>

</body>

</html>